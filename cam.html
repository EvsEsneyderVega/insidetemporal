<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Captura con Texto</title>
    <style>
        video, canvas, img {
            max-width: 300px;
            margin: 10px;
            border: 2px solid #555;
        }
    </style>
</head>
<body>

<h2>Capturar Imagen con Texto</h2>

<select id="selectorCamara">
    <option value="user">C치mara Frontal</option>
    <option value="environment" selected>C치mara Trasera</option>
</select>
<button id="iniciar">Iniciar C치mara</button>
<br><br>

<video id="video" autoplay playsinline></video>
<br>
<button id="capturar">游닝 Capturar Imagen</button>
<br>
<canvas id="canvas" style="display:none;"></canvas>
<br>
<h3>Imagen Capturada:</h3>
<img id="foto" alt="Imagen capturada">

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const foto = document.getElementById('foto');
const btnCapturar = document.getElementById('capturar');
const selectorCamara = document.getElementById('selectorCamara');
const btnIniciar = document.getElementById('iniciar');

let streamActual = null;

btnIniciar.addEventListener('click', () => {
    if (streamActual) {
        streamActual.getTracks().forEach(track => track.stop());
    }

    const modo = selectorCamara.value;

    navigator.mediaDevices.getUserMedia({
        video: { facingMode: modo }
    })
    .then(stream => {
        video.srcObject = stream;
        streamActual = stream;
    })
    .catch(err => {
        console.error('Error al acceder a la c치mara:', err);
        alert('No se pudo acceder a la c치mara.');
    });
});

btnCapturar.addEventListener('click', () => {
    const contexto = canvas.getContext('2d');
    canvas.width = 300;
    canvas.height = 200;

    // Dibujar la imagen de la c치mara
    contexto.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Datos de texto
    const placa = "PLACA: ABC123";
    const ahora = new Date();
    const fecha = `FECHA: ${ahora.getFullYear()}-${String(ahora.getMonth()+1).padStart(2, '0')}-${String(ahora.getDate()).padStart(2, '0')}`;
    const hora = `HORA: ${String(ahora.getHours()).padStart(2, '0')}:${String(ahora.getMinutes()).padStart(2, '0')}`;

    // Estilo del texto
    contexto.fillStyle = "black";
    contexto.font = "16px Arial";
    contexto.lineWidth = 2;
    contexto.strokeStyle = "black";

    // Dibujar textos en la imagen
    contexto.strokeText(placa, 10, 20);
    contexto.fillText(placa, 10, 20);

    contexto.strokeText(fecha, 10, 40);
    contexto.fillText(fecha, 10, 40);

    contexto.strokeText(hora, 10, 60);
    contexto.fillText(hora, 10, 60);

    // Mostrar la imagen
    const dataURL = canvas.toDataURL('image/jpeg', 0.7);
    foto.src = dataURL;
});
</script>

</body>
</html>
