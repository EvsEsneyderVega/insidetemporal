<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Wizard-v6</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" type="text/css" href="css/opensans-font.css">
	<link rel="stylesheet" type="text/css" href="fonts/material-design-iconic-font/css/material-design-iconic-font.min.css">
	<link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css">
	<link rel="stylesheet" href="css/style.css" />
	<style>
		#signature-pad {
			border: 1px solid #000;
			width: 400px;
			height: 200px;
		}
		#buttons {
			margin-top: 10px;
		}
	</style>
</head>

<body>
	<div class="page-content">
		<div class="wizard-heading">Wizard ingreso</div>
		<div class="wizard-v6-content">
			<div class="wizard-form">
				<form class="form-register" id="form-register" action="#" method="post">
					<div id="form-total">
						<!-- Pasos omitidos por brevedad -->
						<h2>
							<p class="step-icon"><span>5</span></p>
							<span class="step-text">Vehículo 3</span>
						</h2>
						<section>
							<div class="inner">
								<div class="form-heading">
									<h3>Datos Del vehículo 3</h3>
									<span>5/5</span>
								</div>
								<div class="form-row">
									<canvas id="signature-pad"></canvas>
									<div id="buttons">
										<button type="button" id="clear">Limpiar</button>
										<button type="button" id="save">Guardar Imagen</button>
									</div>
								</div>
							</div>
						</section>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script src="js/jquery-3.3.1.min.js"></script>
	<script src="js/jquery.steps.js"></script>
	<script src="js/jquery-ui.min.js"></script>
	<script src="js/signature_pad.umd.min.js"></script>
	<script>
		let signaturePad;
		let firmaInicializada = false;

		$(function () {
			$("#form-total").steps({
				headerTag: "h2",
				bodyTag: "section",
				transitionEffect: "fade",
				enableAllSteps: true,
				autoFocus: true,
				transitionEffectSpeed: 500,
				labels: {
					previous: 'ANTERIOR',
					next: 'SIGUIENTE',
					finish: 'ENVIAR',
					current: ''
				},
				onStepChanged: function (event, currentIndex, priorIndex) {
					if (currentIndex === 4 && !firmaInicializada) {
						esperarCanvasVisible();
					}
				}
			});
		});

		function esperarCanvasVisible() {
			const interval = setInterval(() => {
				const canvas = document.getElementById('signature-pad');
				if (canvas && canvas.offsetWidth > 0 && canvas.offsetHeight > 0) {
					clearInterval(interval);
					inicializarSignPad();
					firmaInicializada = true;
				}
			}, 100);
		}

		function inicializarSignPad() {
			const canvas = document.getElementById('signature-pad');
			signaturePad = new SignaturePad(canvas);

			function resizeCanvas() {
				const ratio = Math.max(window.devicePixelRatio || 1, 1);
				canvas.width = canvas.offsetWidth * ratio;
				canvas.height = canvas.offsetHeight * ratio;
				canvas.getContext("2d").scale(ratio, ratio);
				signaturePad.clear();
			}

			window.addEventListener("resize", resizeCanvas);
			resizeCanvas();

			document.getElementById('clear').addEventListener('click', () => {
				signaturePad.clear();
			});

			document.getElementById('save').addEventListener('click', () => {
				if (signaturePad.isEmpty()) {
					alert("Por favor, firma antes de guardar.");
				} else {
					const dataURL = signaturePad.toDataURL();
					window.open(dataURL);
				}
			});
		}
	</script>
</body>

</html>
